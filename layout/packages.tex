% General

\usepackage[utf8]{inputenc}
\usepackage{geometry}
\usepackage{csquotes}
\usepackage{graphicx}
\usepackage{listings}
\usepackage[svgnames, dvipsnames]{xcolor}
\usepackage{comment}
\usepackage{setspace}
\usepackage{appendix}
\usepackage{lipsum}     %testo di prova (si può cancellare una volta iniziato a scrivere)
\usepackage{lineno}
\linenumbers

%\usepackage[9-15]{pagesel}
% attenzione: la filigrana in prima pagina ha opacità massima con questa opzione attivata
% non mettendo la prima pagina comunque appare draft in background

% Math
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{physics}
\usepackage{braket}
\usepackage{mathpartir}
\usepackage{bussproofs}

% Coq-verified theorems symbol.
\newcommand{\BareCoqSymbol}{\includegraphics[height=0.9em]{layout/coq.pdf}}
\newcommand{\CoqSymbol}{\raisebox{-.2ex}{\BareCoqSymbol\,}}
\newcommand{\Coqed}{{\hfill\CoqSymbol}}
\newcommand{\chordalpeo}[1]{\mathrm{Chordal}_{\gls{peo}}\left({#1}\right)}
\newcommand{\chordalind}[1]{\mathrm{Chordal}_{ind}\left({#1}\right)}

% Front page
\usepackage{frontespizio}
\usepackage{tikz}
\usepackage[pages=some]{background}

% Code
\usepackage{alltt}
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily,  % Same font as alltt
    columns=fullflexible,  % Match spacing of alltt
    keepspaces=true        % Preserve spaces like alltt
}

% Colorblind-proof colors
\newcommand{\cbblack}[0]{black}
\newcommand{\cbblue}[0]{RoyalBlue}
\newcommand{\cborange}[0]{Apricot}
\newcommand{\cbred}[0]{RedOrange}
\newcommand{\cbcyan}[0]{Emerald}
\newcommand{\cbpink}[0]{CarnationPink}

\definecolor{myblue}{RGB}{0,0,180}
\definecolor{mygreen}{RGB}{0,120,0}
\definecolor{myred}{RGB}{180,0,0}
\definecolor{mypurple}{RGB}{120,0,120}

\lstdefinestyle{C}{
    language=C,
    mathescape=true,
    tabsize=4,
    keywordstyle=\color{myblue},              % Keywords in blue
    commentstyle=\color{mygreen!50!black},    % Comments in green
    stringstyle=\color{orange},             % Strings in orange
    showstringspaces=false,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    % frame=single,
    breaklines=true
}

\lstdefinelanguage{Rocq}{
    morekeywords=[1]{Definition, Inductive, CoInductive, Class, Instance, Fixpoint, CoFixpoint, Function, Proof, Qed, Module, Fail},
    morekeywords=[2]{forall, exists, match, with, end, if, then, else, let, in, fix, fun, intros, unfold, destruct, lia},
    morekeywords=[3]{Prop, Type, Set, True, False, nat, bool, option, list},
    sensitive=true,
    morecomment=[l]{(*},
    morecomment=[s]{(*}{*)},
    morestring=[b]",
}

\lstdefinestyle{Rocq}{
    language=Rocq,
    mathescape=true,
    keywordstyle=[1]\color{myblue},
    keywordstyle=[2]\color{mypurple},
    keywordstyle=[3]\color{myred},
    tabsize=2,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange},
    showstringspaces=false,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    % frame=single,
    breaklines=true
}

% OCaml language with keyword groups
\lstdefinelanguage{OCaml}{
  sensitive=true,
  morecomment=[s]{(*}{*)},
  morestring=[b]",
  morekeywords=[1]{
    let, rec, in, and, val, type, module, struct, sig, class, object, method,
    inherit, virtual, functor, include, open, external, exception
  },
  morekeywords=[2]{
    if, then, else, match, with, try, when, for, to, downto, while, do, done,
    begin, end, fun, function
  },
  morekeywords=[3]{true, false},
  morekeywords=[4]{of, mutable, private, new, lazy, as, assert}
}

\lstdefinestyle{OCaml}{
    language=OCaml,
    mathescape=true,
    keywordstyle=[1]\color{myblue}\bfseries,    % Declarations
    keywordstyle=[2]\color{mypurple}\bfseries,  % Control flow
    % keywordstyle=[3]\color{orange}\bfseries,    % Constants
    keywordstyle=[4]\color{myred}\bfseries,      % Misc keywords
    tabsize=2,
    basicstyle=\ttfamily\small,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange},
    showstringspaces=false,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    % frame=single,
    breaklines=true,
}

\lstdefinelanguage{NASM}{
  morekeywords={
    mov, add, sub, div, mul, imul, idiv, xor, and, or, inc, dec, jmp, cmp, je, jne, jl, jle, jg, jge, call, ret, push, pop, syscall
  },
  sensitive=true,
  morecomment=[n]{;}{}, % NASM uses ';' for comments
  morestring=[b]",      % Strings in double quotes
  morestring=[b]',      % Strings in single quotes
}

\lstdefinestyle{NASM}{
  language=NASM,
  keywordstyle=\color{myblue}\bfseries,
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  % frame=single,
  basicstyle=\ttfamily,
  breaklines=true
}

% Page header
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\leftmark}
\fancyhead[RO]{\rightmark}
\fancyfoot[LE,RO]{\thepage}


% Bibliography
\usepackage[style=numeric]{biblatex}
\addbibresource{library.bib}

% Abstract
\newenvironment{abstract}%
    {\cleardoublepage%
        \thispagestyle{empty}%
        \null \vfill\begin{center}%
            \bfseries \abstractname \end{center}}%
        {\vfill\null}

% Index
\usepackage{imakeidx}
\makeindex

% Symbols and notations
\usepackage{nomencl}
\makenomenclature

% To load as last packages to avoid problems
\usepackage{glossaries}
\makeglossaries
\newacronym{ra}{RA}{Register Assignment}
\newacronym{jair}{JAIR}{Just Another Intermediate Representation}
\newacronym{ssa}{SSA}{Static Single Assignment}
\newacronym{peo}{PEO}{Perfect Elimination Order}
\newacronym{cfg}{CFG}{Control Flow Graph}
\newacronym{bnf}{BNF}{Backus-Naur Form}
\newacronym{nasm}{NASM}{Netwise Assembler}
\newacronym{jit}{JIT}{Just-In-Time}

\usepackage{graphicx} % Required for inserting images
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
% \usepackage[italian]{babel}
\usepackage{amsmath}
\usepackage{dsfont}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{physics}
\usepackage{mdframed}
\usepackage{textcomp}
% \usepackage[table]{xcolor} %caricalo prima del nicematrix
\usepackage{nicematrix}
\newcolumntype{S}[1]{>{\raggedright\arraybackslash}m{#1}}
\newcolumntype{D}[1]{>{\raggedleft\arraybackslash}m{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\usepackage[all]{xy}
\newcolumntype{L}{>{$}l<{$}}
\newcolumntype{C}{>{$}c<{$}}
\newcolumntype{R}{>{$}r<{$}}
\usepackage{csquotes}
\renewcommand{\arraystretch}{2}
\usepackage{bbm}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}
\newcommand{\prob}[1]{\mathbb{P} \left( #1 \right )}
\newcommand{\E}[1]{\mathbb{E} \left[ #1 \right]}
\newcommand{\EC}[2]{\mathbb{E} \left[ #1 | #2\right]}
\newcommand{\betaold}{\beta^{\text{old}}}
\newcommand{\sigmamat}{\mathbf{\Sigma}}
\newcommand{\addvertex}[3]{#1 \oplus_{#2} #3}
\usepackage{todonotes}
\usepackage{imakeidx}
\usepackage{subcaption}
\usetikzlibrary{arrows.meta, positioning}
\setlength{\parindent}{0pt}
\newcommand{\nt}[1]{\langle\text{#1}\rangle}
\theoremstyle{definition}
\newtheorem{assumption}{Assumption}[section]
\usepackage{cleveref}
\crefname{assumption}{assumption}{assumptions}
\Crefname{assumption}{Assumption}{Assumptions}

% Sharp
\newcommand{\FSharp}{%
  {\settoheight{\dimen0}{F}F\kern-.05em \resizebox{!}{\dimen0}{\raisebox{\depth}{\#}}}}

% Boxes
\newcommand{\textgraybox}[1]{\boxed{#1}}
\newdimen\zzfontsz
\newcommand{\fontsz}[2]{\zzfontsz=#1%
{\fontsize{\zzfontsz}{1.2\zzfontsz}\selectfont{#2}}}
\newcommand{\mathsz}[2]{\text{\fontsz{#1}{$#2$}}}
\newcommand{\instsymColon}{%
     \raisebox{-0.09ex}{\text{\normalfont{:}}}}
\newcommand{\judgboxfontsize}[1]{%
        \mathsz{11pt}{#1}%
}
\newcommand{\judgbox}[2]{%
      {\raggedright \textgraybox{\ensuremath{\judgboxfontsize{#1}}}\!\;%
        \fontsz{9pt}{\begin{tabular}[c]{l} #2 \end{tabular}} %
}}
\newcommand{\judgboxb}[2]{%
  \judgbox{#1}{#2}\hspace{1ex}%
}
\mdfdefinestyle{judgframe}{%
  topline=false, %
  innertopmargin=-2.84ex, %
  innerleftmargin=-.1ex, %
  innerrightmargin=0ex, %
  linewidth=.5pt %
}
\newcounter{judgements}
\crefname{judgements}{judgement}{judgements}
\newcommand{\judgementsref}[1]{\Cref{judgements:#1}}
\newenvironment{judgframe}[4][-2.84ex]
    {\begin{mdframed}[style=judgframe,innertopmargin=#1]\noindent%
      \judgbox{#3}{,,#4''}\def\thejudgements{\ensuremath{#3}}\refstepcounter{judgements}\label[judgements]{judgements:#2}\hrulefill\\[-0.9mm]%
      \begin{center}
    }
  {\end{center}%
   \end{mdframed}%
   \noindent%
  }

\makeindex